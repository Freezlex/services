version: '3.8'

services:
  mqtt:
    container_name: mqtt
    image: eclipse-mosquitto
    networks:
      - proxy-network
    restart: always
    expose:
      - 1883
      - 9001
    volumes:
      - ./mqtt/.data/:/mosquitto/:rw
    labels:
      traefik.enable: true
      traefik.docker.network: mqtt
      traefik.tcp.services.mqtt.loadbalancer.server.port: 1883
      traefik.tcp.services.mqtt_websocket.loadbalancer.server.port: 9001
      traefik.tcp.routers.tcpr_mqtt.entrypoints: mqtt
      traefik.tcp.routers.tcpr_mqtt.rule: HostSNI(`*`)
      traefik.tcp.routers.tcpr_mqtt.service: mqtt
      traefik.tcp.routers.tcpr_mqtt_websocket.entrypoints: websocket
      traefik.tcp.routers.tcpr_mqtt_websocket.rule: HostSNI(`*`)
      traefik.tcp.routers.tcpr_mqtt_websocket.service: mqtt_websocket