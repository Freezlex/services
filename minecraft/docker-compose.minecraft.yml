version: '3.8'

services:
  vanilla:
    image: itzg/minecraft-server:latest
    container_name: vanilla
    environment:
      EULA: "TRUE"
      TYPE: "VANILLA"
      VERSION: "1.20.4"
      MEMORY: "10G"
      SERVER_NAME: "Freezlex's Bathtub"
      # World Type
      LEVEL_TYPE: FLAT
      GENERATOR_SETTINGS: >-4
          {
              "layers": [
                  {
                      "block": "minecraft:bedrock",
                      "height": 1
                  },
                  {
                      "block": "minecraft:stone",
                      "height": 25
                  },
                  {
                      "block": "minecraft:grass",
                      "height": 15
                  }
              ],
              "biome": "minecraft:plains"
          }
      MOTD: "\u00a76\u2500\u00a7e\u2b1d\u00a76\u2500\u00a7e\u2b1d\u00a76\u2500\u00a7e\u2b1d\u00a76\u2500 \u00a7cFreezlex's Bathtub\u00a76 \u2500\u00a7e\u2b1d\u00a76\u2500\u00a7e\u2b1d\u00a76\u2500\u00a7e\u2b1d\u00a76\u2500\n    \u00a79vanilla\u00a76 | \u00a7emc.freezlex.dev\u00a76 | \u00a791.20.4"
      ICON: "https://matrix-client.matrix.org/_matrix/media/r0/download/matrix.org/fOlSCTKsGbDEAEPLAwSmXpro"
      # Auto-pause server when no one is connected
      ENABLE_AUTOPAUSE: "TRUE"
    volumes:
      - ./minecraft/.data:/data:rw
      - ./minecraft/.logs/:/data/logs
    restart: unless-stopped
    labels:
      traefik.enable: true
      traefik.http.routers.vanilla.rule: 'Host(`mc.${DOMAIN_NAME:-localhost}`)'
      # TCP Pass through
      traefik.tcp.routers.vanilla.rule: 'HostSNI(`*`)'
      traefik.tcp.routers.vanilla.entrypoints: minecraft-tcp
      traefik.tcp.services.vanilla.loadbalancer.server.port: 25565
      # UDP Pass through
      traefik.udp.routers.vanilla.entrypoints: minecraft-dup
      traefik.udp.services.vanilla.loadbalancer.server.port: 25565
    networks:
      - proxy-network